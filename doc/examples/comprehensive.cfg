# rax25kb Configuration File
# Copyright (C) 2025-2026 Kris Kirby, KE4AHR
# SPDX-License-Identifier: GPL-3.0-or-later
# Version: 1.6.6
#
# Configuration format: key=value
# Comments start with #
# Strings with spaces can be quoted: key="value with spaces"
#
# IMPORTANT NOTES:
# * Some MFJ-1278 TNCs will start in a 7E1 serial mode by default, IIRC at 2400 bps.
# * What other systems call _polled_mode_ for XKISS is called _polling_mode_ in this application.
# * This application has the ability to emulate a KISS or XKISS TNC on a given port.
# * When KISS or XKISS modes are enabled, serial port is forced to 8N1 per KISS specification.
# * 7-bit serial modes (7N1, 7E1, 7O1) are only used in raw_copy mode.

# ============================================================================
# GLOBAL SETTINGS
# ============================================================================

# Logging
log_level=5                           # 0=EMERG, 5=NOTICE, 9=VERBOSE
logfile=/var/log/rax25kb.log         # Log file path
log_to_console=yes                    # Log to console
# log_to_file_only=no                 # Disable console logging

# Process management
pidfile=/var/run/rax25kb.pid         # PID file

# Packet capture (optional)
# pcap_file=/var/log/rax25kb.pcap    # PCAP capture file

# Startup
quiet_startup=no                      # Suppress startup messages

# ============================================================================
# CROSS-CONNECT 0000: Main TNC - Standard KISS
# ============================================================================

cross_connect0000.serial_port=/dev/ttyUSB0
cross_connect0000.baud_rate=9600
cross_connect0000.data_bits=8         # 7 or 8 (ignored when KISS active, forced to 8)
cross_connect0000.stop_bits=1         # 1 or 2 (ignored when KISS active, forced to 1)
cross_connect0000.parity=none         # none, even, odd (ignored when KISS active)
cross_connect0000.flow_control=none   # none, software, hardware, dtrdsr

# Network configuration
cross_connect0000.tcp_address=0.0.0.0
cross_connect0000.tcp_port=8001

# KISS configuration
cross_connect0000.kiss_port=0         # KISS port number (0-15)

# Features
cross_connect0000.phil_flag=yes       # PhilFlag TASCO modem bug correction
cross_connect0000.parse_kiss=yes      # Parse and log KISS frames
cross_connect0000.dump=no             # Hex dump frames
cross_connect0000.dump_ax25=no        # Dump AX.25 info fields
cross_connect0000.raw_copy=no         # Raw transparent mode (disables KISS)

# ============================================================================
# CROSS-CONNECT 0001: Secondary TNC - Extended KISS (XKISS)
# ============================================================================

cross_connect0001.serial_port=/dev/ttyUSB1
cross_connect0001.baud_rate=9600
cross_connect0001.data_bits=8         # Forced to 8 when XKISS active
cross_connect0001.parity=none         # Ignored when XKISS active
cross_connect0001.stop_bits=1         # Forced to 1 when XKISS active
cross_connect0001.flow_control=none

# Network configuration
cross_connect0001.tcp_address=0.0.0.0
cross_connect0001.tcp_port=8002

# Extended KISS configuration
cross_connect0001.xkiss_mode=yes      # Enable Extended KISS mode
cross_connect0001.xkiss_port=5        # XKISS port number for translation
cross_connect0001.xkiss_checksum=no   # XKISS checksum (default: no)
cross_connect0001.xkiss_polling=no    # XKISS polling mode (default: no)
cross_connect0001.xkiss_poll_timer_ms=100  # Polling timer in milliseconds

# Features
cross_connect0001.phil_flag=no
cross_connect0001.parse_kiss=yes
cross_connect0001.dump=no
cross_connect0001.raw_copy=no

# ============================================================================
# CROSS-CONNECT 0002: MFJ-1278 TNC - 7E1 Mode Example
# ============================================================================
# This example shows configuration for an MFJ-1278 which defaults to 7E1 @ 2400

cross_connect0002.serial_port=/dev/ttyUSB2
cross_connect0002.baud_rate=2400      # MFJ-1278 default
cross_connect0002.data_bits=7         # 7-bit mode
cross_connect0002.parity=even         # Even parity (7E1)
cross_connect0002.stop_bits=1
cross_connect0002.flow_control=none

# This bridge uses raw_copy mode initially for 7E1 communication
# Once TNC is in KISS mode, it will automatically enforce 8N1
cross_connect0002.tcp_address=127.0.0.1
cross_connect0002.tcp_port=8003
cross_connect0002.raw_copy=yes        # Raw mode to allow 7E1
cross_connect0002.kiss_port=0

# ============================================================================
# CROSS-CONNECT 0003: Serial-to-Serial with KISS/XKISS Translation
# ============================================================================
# This demonstrates KISS (port 0) to XKISS (port 3) translation

cross_connect0003.serial_port=/dev/ttyUSB3
cross_connect0003.baud_rate=9600
cross_connect0003.kiss_port=0                    # Source: KISS port 0
cross_connect0003.serial_to_serial=/dev/ttyUSB4  # Connect to another serial port
cross_connect0003.phil_flag=no
cross_connect0003.parse_kiss=yes

# Note: The peer port (cross_connect0004) needs xkiss_mode=yes

# ============================================================================
# CROSS-CONNECT 0004: Peer for 0003 - XKISS Side
# ============================================================================

cross_connect0004.serial_port=/dev/ttyUSB4
cross_connect0004.baud_rate=9600
cross_connect0004.xkiss_mode=yes                 # XKISS mode
cross_connect0004.xkiss_port=3                   # Destination: XKISS port 3
cross_connect0004.xkiss_checksum=yes             # Enable checksums
cross_connect0004.xkiss_polling=yes              # Enable polling
cross_connect0004.xkiss_poll_timer_ms=100        # Poll every 100ms
cross_connect0004.parse_kiss=yes

# ============================================================================
# CROSS-CONNECT 0005: TNC Emulation Example
# ============================================================================
# This cross-connect emulates a KISS TNC - applications connect to it via TCP

cross_connect0005.serial_port=/dev/ttyUSB5
cross_connect0005.baud_rate=19200
cross_connect0005.flow_control=hardware

# Emulate TNC on this TCP port
cross_connect0005.tcp_address=0.0.0.0
cross_connect0005.tcp_port=8005

# KISS configuration for emulation
cross_connect0005.kiss_port=0
cross_connect0005.phil_flag=yes       # Handle TASCO bugs
cross_connect0005.parse_kiss=yes      # Log traffic

# ============================================================================
# CROSS-CONNECT 0006: Raw Copy Mode with 7N1
# ============================================================================
# Example of 7N1 (7 data bits, no parity, 1 stop bit) in raw mode

cross_connect0006.serial_port=/dev/ttyUSB6
cross_connect0006.baud_rate=1200
cross_connect0006.data_bits=7         # 7-bit data
cross_connect0006.parity=none         # No parity (7N1)
cross_connect0006.stop_bits=1
cross_connect0006.tcp_address=127.0.0.1
cross_connect0006.tcp_port=8006
cross_connect0006.raw_copy=yes        # Raw transparent mode

# ============================================================================
# CONFIGURATION NOTES
# ============================================================================
#
# Serial Port Modes:
# ------------------
# When raw_copy=no (KISS/XKISS active):
#   - Serial port forced to 8N1 per KISS specification
#   - data_bits, parity, stop_bits settings are ignored
#   - This is required for proper KISS operation
#
# When raw_copy=yes:
#   - All serial port settings respected
#   - Supports 7N1, 7E1, 7O1, 8N1, 8N2, 8E1, 8O1, etc.
#   - No KISS framing or processing
#
# XKISS Features:
# ---------------
# xkiss_checksum: Add/verify checksums on XKISS frames (default: no)
# xkiss_polling: Respond to poll requests from TNC (default: no)
# xkiss_poll_timer_ms: Poll response timer in milliseconds (default: 100)
#
# PhilFlag Correction:
# --------------------
# Fixes bugs in TASCO modem chipsets:
# - Serial→TCP: Escapes 0xC0 within frames (prevents premature termination)
# - TCP→Serial: Escapes C/c characters (prevents TC0\n command parsing)
#
# TNC Emulation:
# --------------
# rax25kb can emulate a KISS or XKISS TNC endpoint
# Applications connect to rax25kb's TCP port as if it were a hardware TNC
# rax25kb bridges to actual serial TNCs or other rax25kb instances
#
# Cross-Connect Limits:
# ---------------------
# - Maximum 10,000 cross-connects (cross_connect0000 to cross_connect9999)
# - Each requires unique serial port or TCP port
# - One TCP connection per cross-connect (by design)
#
# MFJ-1278 Compatibility:
# -----------------------
# MFJ-1278 TNCs often default to 7E1 at 2400 baud
# Use raw_copy mode initially to communicate at 7E1
# Once in KISS mode, switch to standard KISS configuration
# rax25kb automatically enforces 8N1 when KISS is active
