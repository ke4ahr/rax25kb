.TH RAX25KB 1 "December 2024" "rax25kb 1.0" "User Commands"
.SH NAME
rax25kb \- AX.25 KISS protocol bridge for serial to TCP connections
.SH SYNOPSIS
.B rax25kb
[\fIOPTIONS\fR]
.SH DESCRIPTION
.B rax25kb
is a bridge application that connects a serial port running the KISS (Keep It Simple Stupid) protocol to a TCP socket. It is designed for amateur radio packet applications, allowing APRS and other AX.25 software to communicate with hardware TNCs (Terminal Node Controllers) over TCP/IP.

The application supports both IPv4 and IPv6, can parse and display AX.25 frames, write packet captures to PCAP format, and includes the PhilFlag correction for non-standard KISS implementations.

.SH OPTIONS
.SS "Serial Port Options"
.TP
.BR \-D ", " \-\-device " \fIDEVICE\fR"
Specify the serial port device. On Linux, this is typically
.I /dev/ttyUSB0
or
.IR /dev/ttyACM0 .
On Windows, use
.I COM3
or similar. This option overrides the
.B serial_port
configuration file setting.

.TP
.BR \-b ", " \-\-baud\-rate " \fIRATE\fR"
Set the serial port baud rate. Common values are 1200, 9600, 19200, 38400, and 115200. Default is 9600.

.TP
.BR \-s ", " \-\-stop\-bits " \fI1|2\fR"
Set the number of stop bits. KISS TNC default is 1. Values: 1 or 2.

.TP
.BR \-Q ", " \-\-parity " \fIn|e|o\fR"
Set parity checking. KISS TNC default is none. Values:
.BR n " (none), "
.BR e " (even), "
.BR o " (odd)."

.SS "Flow Control Options"
.TP
.BR \-x ", " \-\-xon\-xoff
Enable software flow control (XON/XOFF). Use this for older modems or devices that support software flow control.

.TP
.BR \-H ", " \-\-rts\-cts
Enable hardware flow control (RTS/CTS). Use this for modern TNCs that support hardware flow control.

.TP
.B \-\-dtr\-dsr
Enable DTR/DSR flow control. Primarily for Windows systems with devices that use Data Terminal Ready and Data Set Ready signals.

.TP
.BR \-N ", " \-\-none
Disable flow control (default). Use when no flow control is needed or supported.

.SS "Network Options"
.TP
.BR \-I ", " \-\-address " \fIADDR\fR"
Specify one or more TCP listener addresses, separated by spaces or commas. Examples:
.BR 0.0.0.0 " (all IPv4 interfaces), "
.BR 127.0.0.1 " (localhost only), "
.BR :: " (all IPv6 interfaces), "
.BR ::1 " (IPv6 localhost), or "
.BR "0.0.0.0 ::" " (both IPv4 and IPv6)."
Default is
.BR 0.0.0.0 .

.TP
.BR \-p ", " \-\-port " \fIPORT\fR"
Set the TCP listening port. Default is 8001.

.TP
.B \-4
Listen on IPv4 addresses only. Filters out IPv6 addresses from the address list.

.TP
.B \-6
Listen on IPv6 addresses only. Filters out IPv4 addresses from the address list.

.SS "Feature Options"
.TP
.BR \-d ", " \-\-dump
Dump KISS frames in xxd-like hexadecimal format. Shows the complete frame contents with both hex and ASCII representation.

.TP
.BR \-k ", " \-\-kiss
Parse and display KISS frame information. Shows the KISS command type, port number, and decoded AX.25 header information including callsigns with SSIDs.

.TP
.BR \-a ", " \-\-ax25
Dump AX.25 information fields in xxd-like format. When combined with
.BR \-k ,
this displays the payload of AX.25 UI frames in human-readable hex dump format.

.TP
.BR \-n ", " \-\-phil
Enable PhilFlag correction. This flag applies corrections for hardware with TASCO modem chipset bugs:
.RS
.IP \(bu 2
.B Serial -> TCP:
Replace unescaped FEND bytes (0xC0) inside KISS frames with the proper escape sequence (0xDB 0xDC).
.IP \(bu 2
.B TCP -> Serial:
Escape 'C' (0x43) and 'c' (0x63) characters as (0xDB 0x43) and (0xDB 0x63) to prevent the radio from parsing "TC0\\n" or "tc0\\n" command sequences.
.RE
.IP
Use this for hardware that doesn't properly implement KISS escaping or that misinterprets certain character sequences as commands.

.TP
.BR \-R ", " \-\-raw\-copy
Enable raw copy mode (transparent pass-through). When enabled, all data is copied bidirectionally between TCP and serial without KISS frame processing. This mode is useful for:
.RS
.IP \(bu 2
Direct terminal access to the TNC
.IP \(bu 2
Non-KISS protocols
.IP \(bu 2
Firmware updates
.IP \(bu 2
TNC configuration
.RE
.IP
Note: PhilFlag, frame parsing, and PCAP capture are disabled in raw copy mode.

.SS "Logging Options"
.TP
.BR \-l ", " \-\-logfile " \fIFILE\fR"
Write log messages to the specified file. Logs include timestamps and severity levels.

.TP
.BR \-L ", " \-\-log\-level " \fILEVEL\fR"
Set the logging level from 0 (emergency) to 9 (verbose). Default is 5 (notice). See
.B LOG LEVELS
section below.

.TP
.B \-\-console\-only
Log only to the console. Disables file logging even if
.B \-l
is specified.

.TP
.B \-\-no\-console
Log only to the specified log file. Disables console output.

.SS "Output Options"
.TP
.B \-\-pcap " \fIFILE\fR"
Write AX.25 frames to a PCAP (packet capture) file. The output can be opened in Wireshark for detailed protocol analysis. Only AX.25 data frames (KISS command 0) are captured.

.TP
.BR \-P ", " \-\-pidfile " \fIFILE\fR"
Write the process ID to the specified file on startup. Useful for init scripts and process management.

.SS "General Options"
.TP
.BR \-c " \fIFILE\fR"
Use the specified configuration file instead of the default
.IR rax25kb.cfg .

.TP
.BR \-q ", " \-\-quiet
Suppress startup banner and configuration display. Errors and log messages are still displayed according to the log level.

.TP
.BR \-h ", " \-\-help
Display help message and exit.

.SH CONFIGURATION FILE
The configuration file
.I rax25kb.cfg
uses a simple
.I key=value
format. Values may be enclosed in double quotes. Lines beginning with
.B #
are comments.

.SS "Configuration Options"
.TP
.B serial_port
Serial port device path (required).

.TP
.B baud_rate
Serial port baud rate. Default: 9600.

.TP
.B stop_bits
Number of stop bits. Values: 1, 2, one, two. KISS TNC default: 1.

.TP
.B parity
Parity checking. Values: none, n, no, even, e, odd, o. KISS TNC default: none.

.TP
.B flow_control
Serial port flow control. Values:
.BR none ", " software ", " hardware ", " dtrdsr .
Alternative spellings accepted:
.BR xon ", " xonxoff ", " xon-xoff ", " rtscts ", " rts-cts ", " rts/cts ", " dtr-dsr ", " dtr/dsr .
Default: none.

.TP
.B tcp_address
TCP listener address(es), space or comma separated. Default: 0.0.0.0.

.TP
.B tcp_port
TCP listener port. Default: 8001.

.TP
.B phil_flag
Enable PhilFlag correction. Values: 0, 1, true, false, yes, no. Default: 0.

.TP
.B dump
Enable frame dumping. Values: 0, 1, true, false, yes, no. Default: 0.

.TP
.B parse_kiss
Enable KISS frame parsing. Values: 0, 1, true, false, yes, no. Default: 0.

.TP
.B dump_ax25
Enable AX.25 info field dumping. Values: 0, 1, true, false, yes, no. Default: 0.

.TP
.B raw_copy
Enable raw copy mode (transparent pass-through). When enabled, all data is copied bidirectionally without KISS frame processing. Values: 0, 1, true, false, yes, no. Default: 0.

.TP
.B log_level
Logging level (0-9). Default: 5.

.TP
.B logfile
Log file path.

.TP
.B pidfile
PID file path.

.TP
.B pcap_file
PCAP output file path.

.SS "Example Configuration File"
.nf
.RS
# rax25kb.cfg - KISS TNC Bridge Configuration
serial_port=/dev/ttyUSB0
baud_rate=9600
stop_bits=1
parity=none
flow_control=none

tcp_address="0.0.0.0 ::"
tcp_port=8001

phil_flag=1
parse_kiss=1
log_level=6

logfile=/var/log/rax25kb.log
pidfile=/var/run/rax25kb.pid
pcap_file=/var/log/rax25kb.pcap
.RE
.fi

.SH LOG LEVELS
.TP
.B 0 - EMERG
System is unusable.
.TP
.B 1 - ALERT
Action must be taken immediately.
.TP
.B 2 - CRIT
Critical conditions.
.TP
.B 3 - ERROR
Error conditions.
.TP
.B 4 - WARN
Warning conditions.
.TP
.B 5 - NOTICE
Normal but significant condition (default).
.TP
.B 6 - INFO
Informational messages.
.TP
.B 7 - DEBUG
Debug-level messages.
.TP
.B 8 - TRACE
Detailed trace messages.
.TP
.B 9 - VERBOSE
Maximum verbosity.

.SH SIGNALS
.TP
.B SIGINT
Graceful shutdown. The application catches Ctrl+C (SIGINT) and exits cleanly.

.SH EXAMPLES
.SS "Basic Usage"
.nf
# Start with default configuration (8N1, no flow control)
rax25kb

# Use specific serial port and baud rate
rax25kb -D /dev/ttyUSB0 -b 19200

# Set serial parameters: 8E1 with hardware flow control
rax25kb -D /dev/ttyUSB0 -b 9600 -Q even -s 1 -H

# Listen on localhost only with KISS parsing
rax25kb -I 127.0.0.1 -p 8001 -k
.fi

.SS "Advanced Usage"
.nf
# Full featured setup with PCAP capture and hardware flow control
rax25kb -D /dev/ttyUSB0 -b 9600 -H \\
        -I "0.0.0.0 ::" -p 8001 \\
        -k -a --pcap /var/log/packets.pcap \\
        -l /var/log/rax25kb.log -L 7

# Hardware with PhilFlag correction and odd parity
rax25kb -D /dev/ttyUSB0 -Q odd -n -k

# Software flow control for older equipment
rax25kb -D /dev/ttyUSB0 -b 1200 -x -s 2

# IPv6 only on specific address
rax25kb -6 -I "2001:db8::1" -p 8001

# Quiet mode with custom config
rax25kb -c /etc/rax25kb/custom.cfg -q
.fi

.SS "Windows Usage"
.nf
# Windows with COM port (8N1 default)
rax25kb.exe -D COM3 -b 9600 -k

# With DTR/DSR flow control
rax25kb.exe -D COM3 --dtr-dsr

# With log file
rax25kb.exe -D COM3 -l C:\\ProgramData\\rax25kb\\log.txt
.fi

.SH FILES
.TP
.I rax25kb.cfg
Default configuration file in the current directory.

.TP
.I /var/log/rax25kb.log
Common location for log files on Unix systems.

.TP
.I /var/run/rax25kb.pid
Common location for PID files on Unix systems.

.SH EXIT STATUS
.TP
.B 0
Successful termination (including SIGINT).
.TP
.B 1
Configuration error, unable to open serial port, or unable to bind to TCP address.

.SH COMPATIBILITY
.SS "Operating Systems"
.B rax25kb
runs on:
.RS
.IP \(bu 2
Linux
.IP \(bu 2
Windows
.IP \(bu 2
macOS
.IP \(bu 2
Other Unix-like systems with serial port support
.RE

.SS "KISS Protocol"
Implements KISS protocol as defined in the ARRL specification with the following frame types:
.RS
.IP \(bu 2
Data frames (command 0)
.IP \(bu 2
TXDELAY (command 1)
.IP \(bu 2
Persistence (command 2)
.IP \(bu 2
SlotTime (command 3)
.IP \(bu 2
TXtail (command 4)
.IP \(bu 2
FullDuplex (command 5)
.IP \(bu 2
SetHardware (command 6)
.IP \(bu 2
Return (command 15)
.RE

.SS "AX.25 Protocol"
Parses AX.25 frames and identifies:
.RS
.IP \(bu 2
I-frames (Information - connected mode)
.IP \(bu 2
S-frames (Supervisory - connected mode)
.IP \(bu 2
U-frames (Unnumbered control)
.IP \(bu 2
UI-frames (Unnumbered Information - unconnected mode, used by APRS)
.RE

.SH NOTES
.SS "KISS TNC Default Settings"
Standard KISS TNCs use 8N1 serial format (8 data bits, No parity, 1 stop bit) with no flow control. The application defaults match these settings. Adjust only if your hardware requires different parameters.

.SS "PhilFlag Correction"
The PhilFlag option corrects two issues found in some TNCs with TASCO modem chipsets:

.TP
.B Serial to TCP (Receive)
Corrects improperly escaped FEND bytes (0xC0) that appear unescaped within KISS frame data. These are automatically converted to the proper escape sequence (0xDB 0xDC). This fixes the TASCO modem chipset bug where raw AX.25 frames are not properly converted to KISS format.

.TP
.B TCP to Serial (Transmit)
Escapes 'C' (0x43) and 'c' (0x63) characters as the sequences (0xDB 0x43) and (0xDB 0x63) to prevent the radio from misinterpreting "TC0\\n" or "tc0\\n" as command sequences. This prevents unintended mode changes or radio resets.

.PP
The PhilFlag correction is bidirectional but applies different transformations in each direction. This is a workaround for non-compliant hardware and should only be enabled when necessary. As the saying goes: "In for drought? No, we are in for turbo-hydrometeorology!"

.SS "PCAP Format"
PCAP files use data link type 147 (USER0) to store raw AX.25 frames. These can be analyzed in Wireshark with appropriate dissectors. Only KISS data frames (command 0) are captured; control frames are ignored.

.SS "Multiple TCP Addresses"
When multiple TCP addresses are specified, the application listens on all of them simultaneously. Each address can accept one client connection at a time. Connections are handled sequentially; the application accepts a new connection only after the previous one closes.

.SS "Serial Port Permissions"
On Unix systems, the user must have read/write permissions to the serial port device. This typically requires membership in the
.B dialout
or
.B uucp
group:
.nf
.RS
sudo usermod -a -G dialout $USER
.RE
.fi

.SH BUGS
Report bugs to the project repository or maintainer.

Known limitations:
.IP \(bu 2
Only one TCP client connection is handled at a time per listener
.IP \(bu 2
No SSL/TLS support for TCP connections
.IP \(bu 2
PCAP timestamps use system time, not packet arrival time

.SH SEE ALSO
.BR kissattach (8),
.BR ax25 (4),
.BR aprx (8),
.BR direwolf (1)

AX.25 Protocol Specification: https://www.tapr.org/pdf/AX25.2.2.pdf
.br
KISS Protocol Specification: https://www.ax25.net/kiss.aspx

.SH AUTHOR
Written for the amateur radio community.

.SH COPYRIGHT
This is free software; see the source for copying conditions.

